/*! pinny 2.0.2 (https://github.com/mobify/pinny.git) */
(function(t){if("function"==typeof define&&define.amd)define(["$","plugin","bouncefix","event-polyfill","velocity","lockup","shade","deckard","isChildOf"],t);else{var n=window.Zepto||window.jQuery;t(n,window.Plugin,window.bouncefix,window.EventPolyfill)}})(function(t,n,i,e,o){function s(t,n){s.__super__.call(this,t,n,s.DEFAULTS)}var a="Pinny requires a declared effect to operate. For more information read: https://github.com/mobify/pinny#initializing-the-plugin",r="a[href], area[href], input, select, textarea, button, iframe, object, embed, [tabindex], [contenteditable]",c="input, select, textarea";Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;return function(){return n.apply(t)}});var h=t(window),d=t.os.ios&&7>=t.os.major,l={PINNY:"pinny",HEADER:"pinny__header",WRAPPER:"pinny__wrapper",SPACER:"pinny__spacer",TITLE:"pinny__title",CLOSE:"pinny__close",CONTENT:"pinny__content",OPENED:"pinny--is-open",SCROLLABLE:"pinny--is-scrollable"},p={COMPONENT:'<{0} class="'+l.PINNY+'__{0}">{1}</{0}>',HEADER:'<h1 class="'+l.TITLE+'">{0}</h1><button class="'+l.CLOSE+'">Close</button>',FOOTER:"{0}"},u={click:"click.pinny",focus:"focus.pinny",blur:"blur.pinny",resize:"resize.pinny",orientationchange:"orientationchange.pinny"};return s.VERSION="2.0.2",s.DEFAULTS={effect:null,container:null,appendTo:null,structure:{header:"",footer:!1},zIndex:2,cssClass:"",coverage:"100%",easing:"swing",duration:200,shade:{},open:t.noop,opened:t.noop,close:t.noop,closed:t.noop,scrollDuration:50,spacerHeight:300},n.create("pinny",s,{animation:{openComplete:function(){var t=this;this._disableExternalInputs(),this._focus(),!this._activePinnies()&&this.$pinny.lockup("lock"),e.on(u.resize,function(){t._repaint()}),!this._activePinnies()&&d&&h.on(u.orientationchange,this._blurActiveElement.bind(this)),this.$pinny.addClass(l.OPENED).attr("aria-hidden","false"),i.add(l.SCROLLABLE),this.$container.attr("aria-hidden","true"),this._trigger("opened")},closeComplete:function(){this.$pinny.removeClass(l.OPENED).attr("aria-hidden","true"),this._enableExternalInputs(),this._resetFocus(),this._activePinnies()||(this.$pinny.lockup("unlock"),e.off(u.resize),h.off(u.orientationchange)),i.remove(l.SCROLLABLE),this.$container.attr("aria-hidden","false"),this._trigger("closed")}},_init:function(n){if(this.id="pinny-"+t.uniqueId(),this.$element=t(n),this.$doc=t(document),this.$body=t("body"),this._build(),!this.options.effect)throw a;this.effect=this.options.effect.call(this),this.$element.removeAttr("hidden"),this._bindEvents()},destroy:function(){this.$pinny.lockup("destroy"),this.$pinny.shade("destroy"),this.$pinny.remove(),e.off(),this.$element.appendTo(document.body).removeData(this.name)},toggle:function(){this[this.$pinny.hasClass(l.OPENED)?"close":"open"]()},open:function(){this._isOpen()||(this._trigger("open"),this.options.shade&&this.$shade.shade("open"),this.effect.open.call(this))},close:function(){this._isOpen()&&(this._trigger("close"),this.options.shade&&this.$shade.shade("close"),this.effect.close.call(this))},_isOpen:function(){return this.$pinny.hasClass(l.OPENED)},_bindEvents:function(){var n=this.$pinny;n.on("touchmove",function(n){t(n.target).parents().hasClass(l.CONTENT)||n.preventDefault()})},_build:function(){var n=this;if(this.$pinny=t("<section />").addClass(l.PINNY).addClass(this.options.cssClass).css({position:"fixed",zIndex:this.options.zIndex,width:this.options.coverage,height:this.options.coverage}).on(u.click,"."+l.CLOSE,function(t){t.preventDefault(),n.close()}).lockup({container:this.options.container,locked:function(){n._handleKeyboardShown()},unlocked:function(){n._handleKeyboardHidden()}}),this.$container=this.$pinny.data("lockup").$container,this.$pinny.appendTo(this.options.appendTo?t(this.options.appendTo):this.$container),this.options.structure){var i=t("<div />").addClass(l.WRAPPER).appendTo(this.$pinny);this._buildComponent("header").appendTo(i),t("<div />").addClass(l.CONTENT).addClass(l.SCROLLABLE).append(this.$element).append(this.$spacer).appendTo(i),this._buildComponent("footer").appendTo(i)}else this.$element.appendTo(this.$pinny);this.$header=this.$pinny.find("."+l.HEADER),this.$content=this.$pinny.find("."+l.CONTENT),this.$spacer=t("<div />").addClass(l.SPACER).height(this.options.spacerHeight).attr("hidden","hidden").appendTo(this.$content),this._addAccessibility(),this.options.shade&&(this.$shade=this.$pinny.shade(t.extend(!0,{},{click:function(){n.close()}},t.extend(this.options.shade,{duration:this.options.duration}))))},_buildComponent:function(n){var i=this.options.structure[n],e=t([]);if(i!==!1){var o=this._isHtml(i)?i:p[n.toUpperCase()].replace("{0}",i);e=t(p.COMPONENT.replace(/\{0\}/g,n).replace(/\{1\}/g,o))}return e},_isHtml:function(t){return/<[a-z][\s\S]*>/i.test(t)},_activePinnies:function(){return!!t("."+l.OPENED).length},_coverage:function(t){var n,i=this.options.coverage.match(/(\d*)%$/);return i&&(n=100-parseInt(i[1]),t&&(n/=t)),i?n+"%":this.options.coverage},_addAccessibility:function(){var t=this.id+"__header",n=this.$pinny.find("h1, ."+l.TITLE).first(),i=this.$pinny.find("."+l.WRAPPER);this.$container.attr("aria-hidden","false"),this.$pinny.attr("role","dialog").attr("aria-labelledby",t).attr("aria-hidden","true").attr("tabindex","-1"),i.attr("role","document"),n.attr("id",t)},_repaint:function(){window.scrollTo(document.body.scrollLeft,document.body.scrollTop+1)},_focus:function(){this.originalActiveElement=document.activeElement,this.$pinny.children().first().focus()},_resetFocus:function(){this.originalActiveElement&&this.originalActiveElement.focus()},_disableExternalInputs:function(){if(!this.$pinny.lockup("isLocked")){var n=t(r).not(function(){return t(this).isChildOf("."+l.PINNY)});n.each(function(n,i){var e=t(i),o=e.attr("tabindex")||0;e.attr("data-orig-tabindex",o).attr("tabindex","-1")})}},_enableExternalInputs:function(){this._activePinnies()||t("[data-orig-tabindex]").each(function(n,i){var e=t(i),o=parseInt(e.attr("data-orig-tabindex"));o?e.attr("tabindex",o):e.removeAttr("tabindex"),e.removeAttr("data-orig-tabindex")})},_handleKeyboardShown:function(){if(d){var t=function(){this._showSpacer(),this._scrollToTarget()};this.$pinny.find(c).on(u.focus,t.bind(this)).on(u.blur,this._hideSpacer.bind(this)),t.call(this)}},_handleKeyboardHidden:function(){d&&this.$pinny.find(c).off(u.focus).off(u.blur)},_scrollToTarget:function(){o.animate(this._scrollTarget(),"scroll",{container:this.$content[0],offset:-1*(this.$header.height()+parseInt(this.$content.css("padding-top"))),duration:this.options.scrollDuration})},_showSpacer:function(){this.$spacer.removeAttr("hidden")},_hideSpacer:function(){!this._activeElement().is(c)&&this.$spacer.attr("hidden","")},_activeElement:function(){return t(document.activeElement)},_blurActiveElement:function(){this._activeElement().blur()},_scrollTarget:function(){for(var t=this._activeElement(),n=t.parent();"relative"===n.css("position")&&!n.hasClass(l.CONTENT);)t=n,n=t.parent();return t}}),t("[data-pinny]").each(function(){var n=t(this),i=t(this).data("pinny");if(!i.length)throw a;n.pinny({effect:i})}),t});